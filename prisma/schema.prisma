generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String                    @id @default(uuid())
  email         String                    @unique
  name          String?
  role          UserRole                  @default(member)
  createdAt     DateTime                  @default(now())
  updatedAt     DateTime                  @updatedAt
  auditLogs     AuditLog[]
  subscriptions Subscription[]
  memberships   UserWorkspaceMembership[]
  workspaces    Workspace[]               @relation("WorkspaceOwner")
}

model Subscription {
  id              String             @id @default(uuid())
  userId          String
  workspaceId     String?
  planId          String
  provider        String
  providerOrderId String?            @unique
  status          SubscriptionStatus @default(pending)
  amountCents     Int
  currency        String             @default("USD")
  startedAt       DateTime?
  expiresAt       DateTime?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  plan            SubscriptionPlan   @relation(fields: [planId], references: [id])
  user            User               @relation(fields: [userId], references: [id])
  workspace       Workspace?         @relation(fields: [workspaceId], references: [id])
}

model Workspace {
  id                 String                    @id @default(uuid())
  name               String
  slug               String                    @unique
  ownerId            String
  subscriptionPlanId String?
  createdAt          DateTime                  @default(now())
  updatedAt          DateTime                  @updatedAt
  contentPlans       ContentPlan[]
  niches             Niche[]
  shortVideos        ShortVideo[]
  subscriptions      Subscription[]
  memberships        UserWorkspaceMembership[]
  owner              User                      @relation("WorkspaceOwner", fields: [ownerId], references: [id])
  subscriptionPlan   SubscriptionPlan?         @relation(fields: [subscriptionPlanId], references: [id])
  youtubeConfigs     YouTubeChannelConfig[]
}

model SubscriptionPlan {
  id                String         @id @default(uuid())
  name              String
  priceMonthly      Int
  maxWorkspaces     Int
  maxChannels       Int
  maxVideosPerMonth Int
  subscriptions     Subscription[]
  workspaces        Workspace[]
}

model UserWorkspaceMembership {
  id          String        @id @default(uuid())
  userId      String
  workspaceId String
  role        WorkspaceRole @default(viewer)
  user        User          @relation(fields: [userId], references: [id])
  workspace   Workspace     @relation(fields: [workspaceId], references: [id])

  @@unique([userId, workspaceId])
}

model YouTubeChannelConfig {
  id                  String    @id @default(uuid())
  workspaceId         String
  channelName         String
  channelId           String?
  youtubeAccessToken  String
  youtubeRefreshToken String
  tokenExpiry         DateTime
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  workspace           Workspace @relation(fields: [workspaceId], references: [id])
}

model Niche {
  id           String        @id @default(uuid())
  workspaceId  String
  name         String
  description  String
  isActive     Boolean       @default(true)
  contentPlans ContentPlan[]
  workspace    Workspace     @relation(fields: [workspaceId], references: [id])
  shortVideos  ShortVideo[]

  @@unique([workspaceId, name])
}

model ContentPlan {
  id          String       @id @default(uuid())
  workspaceId String
  nicheId     String
  timeframe   Timeframe
  startDate   DateTime
  endDate     DateTime
  createdAt   DateTime     @default(now())
  niche       Niche        @relation(fields: [nicheId], references: [id])
  workspace   Workspace    @relation(fields: [workspaceId], references: [id])
  shortVideos ShortVideo[]
}

model ShortVideo {
  id             String           @id @default(uuid())
  workspaceId    String
  contentPlanId  String
  nicheId        String
  dayIndex       Int
  hook           String
  title          String
  script         String
  hashtags       String
  status         ShortVideoStatus @default(idea)
  youtubeVideoId String?
  youtubeUrl     String?
  scheduledAt    DateTime?
  uploadedAt     DateTime?
  contentPlan    ContentPlan      @relation(fields: [contentPlanId], references: [id])
  niche          Niche            @relation(fields: [nicheId], references: [id])
  workspace      Workspace        @relation(fields: [workspaceId], references: [id])
}

model AuditLog {
  id        String   @id @default(uuid())
  userId    String
  action    String
  details   String
  timestamp DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id])
}

enum UserRole {
  admin
  member
  superuser
}

enum SubscriptionStatus {
  pending
  active
  cancelled
  failed
}

enum WorkspaceRole {
  owner
  editor
  viewer
}

enum Timeframe {
  weekly
  monthly
  custom
}

enum ShortVideoStatus {
  idea
  scripted
  ready_to_upload
  uploaded
  failed
}
